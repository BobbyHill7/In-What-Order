<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>In What Order? – Raw Manta Ray</title>
<style>
:root {
  --bg: #1E2A3A;
  --panel: #28344B;
  --text: #F3F4F6;
  --accent: #FFD700;
  --blue: #60A5FA;
  --green: #22C55E;
  --yellow: #FACC15;
  --red: #EF4444;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
  height: 100vh;
  overflow: hidden;
}

header {
  text-align: center;
  padding: 12px;
  font-size: 28px;
  font-weight: 800;
  color: var(--accent);
}

main {
  display: grid;
  grid-template-columns: 320px 1fr;
  height: calc(100vh - 64px);
}

.instructions {
  padding: 16px;
  background: var(--panel);
  font-size: 14px;
}

.instructions h2 {
  margin-top: 0;
  color: var(--accent);
}

.game-area {
  padding: 16px;
  position: relative;
}

.question {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 12px;
}

.timer {
  position: fixed;
  top: 16px;
  right: 16px;
  background: var(--panel);
  padding: 12px 18px;
  font-size: 32px;
  font-weight: 900;
  border-radius: 12px;
  color: var(--accent);
  z-index: 1000;
}

.controls {
  margin-bottom: 10px;
}

button {
  background: var(--accent);
  border: none;
  padding: 8px 14px;
  font-size: 14px;
  font-weight: 700;
  border-radius: 6px;
  cursor: pointer;
}

ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.item {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #1f2937;
  margin-bottom: 6px;
  padding: 6px 10px;
  border-radius: 8px;
  cursor: grab;
  border: 2px solid transparent;
}

.item img {
  width: 36px;
  height: 36px;
  object-fit: contain;
}

.item.green { border-color: var(--green); box-shadow: 0 0 10px var(--green); }
.item.yellow { border-color: var(--yellow); box-shadow: 0 0 10px var(--yellow); }
.item.red { border-color: var(--red); box-shadow: 0 0 10px var(--red); }

.scorecard {
  margin-top: 12px;
  font-size: 20px;
  font-weight: 800;
  color: var(--accent);
}

canvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
}
</style>
</head>
<body>

<header>In What Order? – Raw Manta Ray</header>

<div class="timer" id="timer">48</div>

<main>
  <aside class="instructions">
    <h2>Instructions</h2>
    <p>Order the updates from <strong>earliest to latest</strong>.</p>
    <p>You may submit multiple times.</p>
    <p>Each incorrect submission costs <strong>5 seconds</strong>.</p>
    <p>Yellow = correct relative order.<br>Green = fully correct.</p>
  </aside>

  <section class="game-area">
    <div class="question">
      In what order of content updates did more sources for raw manta rays get added into the game?
    </div>

    <div class="controls">
      <button id="startBtn">Start Game</button>
      <button id="submitBtn" disabled>Submit</button>
    </div>

    <ul id="list"></ul>

    <div class="scorecard" id="scorecard"></div>
  </section>
</main>

<canvas id="confetti"></canvas>

<script>
const data = [
 { id:1, name:"Fossil Island", date:"September 2017", img:"https://oldschool.runescape.wiki/images/Fossil_Island_logo.png?f8132"},
 { id:2, name:"Brimstone Chest", date:"February 2019", img:"https://oldschool.runescape.wiki/images/Brimstone_chest.png?23463"},
 { id:3, name:"The Mimic", date:"April 2019", img:"https://oldschool.runescape.wiki/images/thumb/The_Mimic.png/1024px-The_Mimic.png?b45f4"},
 { id:4, name:"Larran’s Chest", date:"June 2019", img:"https://oldschool.runescape.wiki/images/Larran%27s_big_chest.png?eb3ea"},
 { id:5, name:"Tempoross", date:"March 2021", img:"https://oldschool.runescape.wiki/images/Tempoross.png?12042"},
 { id:6, name:"Tombs of Amascut", date:"August 2022", img:"https://oldschool.runescape.wiki/images/Tombs_of_Amascut.png?f9992"},
 { id:7, name:"The Leviathan", date:"July/August 2023", img:"https://oldschool.runescape.wiki/images/The_Leviathan.png?d588a"},
 { id:8, name:"Killing a Manta Ray", date:"November 2025", img:"https://oldschool.runescape.wiki/images/Manta_ray_%28Sailing%29.png?80b30"}
];

const list = document.getElementById("list");
const timerEl = document.getElementById("timer");
const scorecard = document.getElementById("scorecard");

let time = 48;
let interval;
let started = false;
let ended = false;
let datesShown = false;

function shuffle(arr){ return [...arr].sort(()=>Math.random()-0.5); }

function render(items){
 list.innerHTML="";
 items.forEach(i=>{
  const li=document.createElement("li");
  li.className="item";
  li.draggable=started && !ended;
  li.dataset.id=i.id;
  li.innerHTML=`<img src="${i.img}"><span>${i.name}</span>`;
  list.appendChild(li);
 });
 enableDrag();
}

function enableDrag(){
 let drag;
 list.querySelectorAll(".item").forEach(item=>{
  item.ondragstart=e=>drag=item;
  item.ondragover=e=>{
   e.preventDefault();
   if(drag!==item){
     const r=item.getBoundingClientRect();
     const after=e.clientY>r.top+r.height/2;
     list.insertBefore(drag, after?item.nextSibling:item);
   }
  };
 });
}

function evaluate(){
 const items=[...list.children];
 let greens=0, yellows=0;
 items.forEach((el,idx)=>{
  el.classList.remove("green","yellow","red");
  const correctIdx=data.findIndex(d=>d.id==el.dataset.id);
  if(correctIdx===idx){ el.classList.add("green"); greens++; }
  else {
   let ok=true;
   items.forEach((o,j)=>{
    if(j===idx) return;
    const ci=data.findIndex(d=>d.id==o.dataset.id);
    if((ci<correctIdx && j>idx)||(ci>correctIdx && j<idx)) ok=false;
   });
   el.classList.add(ok?"yellow":"red");
   if(ok) yellows++;
  }
 });
 return {greens,yellows};
}

function showDates(){
 if(datesShown) return;
 [...list.children].forEach(el=>{
  const d=data.find(i=>i.id==el.dataset.id);
  el.querySelector("span").textContent+=` — ${d.date}`;
 });
 datesShown=true;
}

function endGame(win){
 ended=true;
 clearInterval(interval);
 document.getElementById("submitBtn").disabled=true;
 showDates();

 const {greens,yellows}=evaluate();
 const correctness=(greens+yellows)*10;
 const timeScore=Math.min(time,20);
 const score=correctness+timeScore;

 scorecard.textContent=`Final Score: ${score}/100`;

 if(win) confetti();
}

document.getElementById("startBtn").onclick=()=>{
 if(started) return;
 started=true;
 render(shuffle(data));
 document.getElementById("submitBtn").disabled=false;
 interval=setInterval(()=>{
  time--;
  timerEl.textContent=time;
  if(time<=0) endGame(false);
 },1000);
};

document.getElementById("submitBtn").onclick=()=>{
 if(ended) return;
 const {greens}=evaluate();
 if(greens===data.length){
   endGame(true);
 } else {
   time=Math.max(0,time-5);
   timerEl.textContent=time;
 }
};

function confetti(){
 const c=document.getElementById("confetti");
 const ctx=c.getContext("2d");
 c.width=innerWidth; c.height=innerHeight;
 let pieces=[...Array(150)].map(()=>({
  x:Math.random()*c.width,
  y:Math.random()*-c.height,
  r:Math.random()*6+4,
  vy:Math.random()*3+2
 }));
 let t=0;
 (function draw(){
  ctx.clearRect(0,0,c.width,c.height);
  pieces.forEach(p=>{
   ctx.fillStyle=["#FFD700","#22C55E","#60A5FA"][Math.floor(Math.random()*3)];
   ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,7); ctx.fill();
   p.y+=p.vy;
  });
  if(t++<120) requestAnimationFrame(draw);
 })();
}
</script>
</body>
</html>
